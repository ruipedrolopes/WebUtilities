<html>

<head>
    <title>DENCODER</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB2aWV3Qm94PSIxMjQuODkyIDE0NC43MDcgMjAwLjMxIDEwNi4wMDkiIHdpZHRoPSIyMDAuMzEiIGhlaWdodD0iMTA2LjAwOSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczpieD0iaHR0cHM6Ly9ydWlwZWRyb2xvcGVzLmdpdGh1Yi5pbyI+CiAgPGcgc3R5bGU9IiIgdHJhbnNmb3JtPSJtYXRyaXgoMC44NDMxMDksIC0wLjAzNzU3MywgMCwgMS4yMTgwNjgsIDE5LjU5NDQyNSwgLTQzLjUzMTk1NikiPgogICAgPGcgc3R5bGU9IiIgdHJhbnNmb3JtPSJtYXRyaXgoMSwgMCwgMCwgMS4zMjE2NzUsIC05NC4zMzU1MjYsIDc2LjA0NDU3MSkiPgogICAgICA8cmVjdCB4PSIyNDguNzkxIiB5PSI5NC43MTEiIHdpZHRoPSIxNTAuODUyIiBoZWlnaHQ9IjEwLjI3IiBzdHlsZT0ic3Ryb2tlOiByZ2IoMCwgMCwgMCk7IHN0cm9rZS13aWR0aDogMHB4OyBmaWxsOiByZ2IoMjU1LCAyNTUsIDApOyIgdHJhbnNmb3JtPSJtYXRyaXgoMC45OTk5OSwgLTAuMDA0NDc5LCAtMC40MzQzOTMsIDEuMDAxOTU2LCAxNi4wNDIxMTIsIDEwLjQ0OTM0MykiLz4KICAgICAgPHBhdGggZD0iTSAzNjYuMzYzIDM4LjIyNSBMIDM5My4wNTUgMTIwLjA0OSBMIDM2Ni4zNjMgMTIwLjA0OSBMIDM2Ni4zNjMgMzguMjI1IFoiIHN0eWxlPSJzdHJva2U6IHJnYigwLCAwLCAwKTsgc3Ryb2tlLXdpZHRoOiAwcHg7IGZpbGw6IHJnYigyNTUsIDI1NSwgMCk7IiB0cmFuc2Zvcm09Im1hdHJpeCgtMC4zODM5MjYsIDAuOTIzMzY0LCAtMS4wOTI5NjksIDAuMDIzOTg0LCA2MzIuODk0MTA0LCAtMjM3LjY1ODk2NikiIGJ4OnNoYXBlPSJ0cmlhbmdsZSAzNjYuMzYzIDM4LjIyNSAyNi42OTIgODEuODI0IDAgMCAxQDhhMzNkY2U1Ii8+CiAgICA8L2c+CiAgICA8ZyBzdHlsZT0iIiB0cmFuc2Zvcm09Im1hdHJpeCgtMSwgMCwgMCwgLTEuMzIxNjc4LCA1ODEuNzA0NTI5LCAzMzUuMDk3MDQ2KSI+CiAgICAgIDxyZWN0IHg9IjI0OC43OTEiIHk9Ijk0LjcxMSIgd2lkdGg9IjE1MC44NTIiIGhlaWdodD0iMTAuMjciIHN0eWxlPSJzdHJva2U6IHJnYigwLCAwLCAwKTsgc3Ryb2tlLXdpZHRoOiAwcHg7IGZpbGw6IHJnYigwLCAxNzQsIDI1NSk7IiB0cmFuc2Zvcm09Im1hdHJpeCgwLjk5OTk5LCAtMC4wMDQ0NzksIC0wLjQzNDM5MywgMS4wMDE5NTYsIDE2LjA0MjExMiwgMTAuNDQ5MzQzKSIvPgogICAgICA8cGF0aCBkPSJNIDM2Ni4zNjMgMzguMjI1IEwgMzkzLjA1NSAxMjAuMDQ5IEwgMzY2LjM2MyAxMjAuMDQ5IEwgMzY2LjM2MyAzOC4yMjUgWiIgc3R5bGU9InN0cm9rZTogcmdiKDAsIDAsIDApOyBzdHJva2Utd2lkdGg6IDBweDsgZmlsbDogcmdiKDAsIDE3NCwgMjU1KTsiIHRyYW5zZm9ybT0ibWF0cml4KC0wLjM4MzkyNiwgMC45MjMzNjQsIC0xLjA5Mjk2OSwgMC4wMjM5ODQsIDYzMi44OTQxMDQsIC0yMzcuNjU4OTY2KSIgYng6c2hhcGU9InRyaWFuZ2xlIDM2Ni4zNjMgMzguMjI1IDI2LjY5MiA4MS44MjQgMCAwIDFAOGEzM2RjZTUiLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPg==">
    <!-- General -->
    <style>
        body {
            margin: 20px;
            font-family: sans-serif;
            background-color: #353535;
            color: silver;
        }

        input {
            background-color: darkgray;
            border-radius: 4pt
        }

        textarea {
            width: 100%;
            height: 50%;
            max-width: 100%;
            background-color: rgb(36, 36, 36);
            color: silver;
            caret-color: orange;
        }

        textarea::selection {
            color: #101010;
            background-color: darkgray;
        }

        .buttonGroup,
        .checkAlign {
            display: inline-block;
            vertical-align: top;
        }

        .settingsGroup {
            padding-left: 5px;
        }
        
        .settingsGroup>label {
            line-height: 30px;
        }

        .buttonGroup>label {
            user-select: none;
        }

        input[type=checkbox] {
            margin: revert;
        }

        input[type=text], input[type=number] {
            font-family: monospace;
            background-color: rgb(36, 36, 36);
            color: silver;
            margin: revert;
        }

        input[type=range] {
            margin: revert;
        }

        .historyItem {
            height: 100px;
            font-size: small;
            border-bottom: solid 3px;
            overflow: hidden;
            white-space: nowrap;
            background-color: #242424;
            color: #ccc;
            font-family: monospace;
            user-select: none;
            padding: 2px;
        }

        .sidebar {
            position: absolute; top: 0px; bottom: 0px; right: 0px;
        }

        .sidebarExpanded {
            right: 203px;
        }

        .sidebarExpanded .sidebarBody {
            display: block !important;
        }

        .sidebar .sidebarBody {
            position: absolute;
            top: 0px;
            left: 20px;
            width: 200px;
            background-color: #ccc;
            bottom: 0px;
            border-left: solid 3px;
            overflow-y: auto;
            display: none;
        }


    </style>
    <!-- Controls -->
    <style>
        .switch {
            color: black;
            position: relative;
            display: inline-block;
            width: 120px;
            height: 30px;
            font-size: 14px;
            font-weight: 500;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
            margin-top: 16px;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            text-align: center;
        }

        .slider-copy:after {
            content: "Transform";
        }

        input:checked+.slider-copy:after {
            content: "Copy";
        }

        .slider-padding:after {
            content: "Spaces";
        }

        input:checked+.slider-padding:after {
            content: "Tabs";
        }

        .slider-selection:after {
            content: "All";
        }

        input:checked+.slider-selection:after {
            content: "Selection";
        }
        
        .slider-sort:after {
            content: "Asc.";
        }

        input:checked+.slider-sort:after {
            content: "Desc.";
        }

        .slider:after {
            line-height: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            box-shadow: 2px 2px 8px 1px #434343ba
        }

        input:checked+.slider {
            background-color: #2196F3;
        }

        input:focus+.slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked+.slider:before {
            -webkit-transform: translateX(90px);
            -ms-transform: translateX(90px);
            transform: translateX(90px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 30px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        .button {
            background-color: #ccc;
            border: 2px solid #7c7c7c;
            color: #000000;
            padding: 6px 22px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            transition-duration: 0.4s;
            cursor: pointer;
            border-radius: 8px;
            width: 100%;
        }

        .button:hover {
            background-color: #4d4d4d;
            border: 2px solid #c5c5c5;
            color: white;
        }

        .button:active {
            background-color: #2196F3;
            border: 2px solid #7c7c7c;
            color: #000000;
        }

        .button-xsmall {
            padding: 2px 12px;
            font-size: 14px;
        }


        .off-on {
            width: 40px;
            height: 20px;
            position: relative;
            display: inline-block;
            margin: 5px 0;
        }

        .off-on-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .off-on input {
            opacity: 0;
            width: 0;
            height: 0;
            margin-top: 16px;
        }

        .off-on-slider:after {
            line-height: 20px;
        }

        .off-on-slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            box-shadow: 1px 1px 3px 1px #434343ba
        }

        input:checked+.off-on-slider {
            background-color: #2196F3;
        }

        input:focus+.off-on-slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked+.off-on-slider:before {
            -webkit-transform: translateX(20px);
            -ms-transform: translateX(20px);
            transform: translateX(20px);
        }

        .off-on-slider.round {
            border-radius: 10px;
        }

        .off-on-slider.round:before {
            border-radius: 50%;
        }

        .off-on+label {
            cursor: pointer;
            user-select: none;
        }

        .off-on+label:before {
            content: " ";
        }

        input[type="range"] {
            -webkit-appearance: none;
            height: 7px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 5px;
            background-image: linear-gradient(#2196F3, #2196F3);
            background-repeat: no-repeat;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 15px;
            width: 15px;
            border-radius: 50%;
            background: #2196F3;
            cursor: ew-resize;
            box-shadow: 0 0 3px 0 #555;
            transition: background .3s ease-in-out;
        }

        input[type="range"]::-moz-range-thumb {
            -webkit-appearance: none;
            height: 15px;
            width: 15px;
            border-radius: 50%;
            background: #2196F3;
            cursor: ew-resize;
            box-shadow: 0 0 3px 0 #555;
            transition: background .3s ease-in-out;
        }

        input[type="range"]::-ms-thumb {
            -webkit-appearance: none;
            height: 15px;
            width: 15px;
            border-radius: 50%;
            background: #2196F3;
            cursor: ew-resize;
            box-shadow: 0 0 3px 0 #555;
            transition: background .3s ease-in-out;
        }

        input[type=range]::-webkit-slider-runnable-track {
            -webkit-appearance: none;
            box-shadow: none;
            border: none;
            background: transparent;
        }

        input[type=range]::-moz-range-track {
            -webkit-appearance: none;
            box-shadow: none;
            border: none;
            background: transparent;
        }

        input[type=range]::-ms-track {
            -webkit-appearance: none;
            box-shadow: none;
            border: none;
            background: transparent;
        }
    </style>
    <script type="text/javascript">

        window.onload = function () {
            var valueTextArea = getValueElement();
            valueTextArea.onmouseup =
            valueTextArea.onkeyup =
            valueTextArea.ontouchend =
            valueTextArea.onselect =
            valueTextArea.onselectionchange =
            valueTextArea.oninput =
            valueTextArea.onmouseleave = fetchData;
            
            document.getElementById("rndSpecialChars").onkeydown = preventInvalidSpecialChars;
            document.getElementById("rndStringLengthNumberInput").oninput = preventInvalidRndLength;

            adjustRndStringSlider(document.getElementById("rndStringLength"));

            initHistory();
        }

        function transform(transformer, params) {
            if (typeof transformer != "function") {
                console.warn("Transformer is not a function.");
                return;
            }

            var value = getValueElement().value;
            if (document.getElementById("cbSelection").checked) {
                value = value.substr(cursorPos.start, cursorPos.end - cursorPos.start);
            }
            
            try {
                var result = transformer(value, params);

                if (typeof result != "string") {

                    if (typeof result == "object" && typeof result.promise == "object" && typeof result.promise.then == "function") {
                        // this has a promise

                        result.promise.then((promiseResult) => {
                            addToHistory();
                            var b64result = auxiliary.arrayBufferToBase64(promiseResult);
                            
                            if(result.finalize) {
                                displayResult(eval(result.finalize)(b64result));
                            } else {
                                displayResult(b64result);
                            }
                        });
                        return;
                    }

                    console.warn("Transformer returned an invalid value.");
                    return;
                }

                addToHistory();

                displayResult(result);
            } catch(e) {
                error("An error occured: " + e, 4000);
                throw e;
            }
        }

        function generate(generator, params) {
            if (typeof generator != "function") {
                console.warn("generator is not a function.");
                return;
            }

            try {
                var result = generator(params);

                if (typeof result != "string") {
                    console.warn("Transformer returned an invalid value.");
                    return;
                }

                addToHistory();

                displayResult(result);
            } catch(e) {
                error("An error occured: " + e, 4000);
                throw e;
            }
        }

        function getValueElement() {
            return document.getElementById("value");
        }

        function addToHistory() {
            var value = getValueElement().value;
            if(value.length == 0) {
                return;
            }
            var history = JSON.parse(sessionStorage.getItem("history"));

            //prevent history filling when changing random size
            if(history.length > 0 && history[history.length-1].t > new Date().valueOf() - 300) {
                return;
            }

            if(history.length > 32) {
                history = history.sort((a, b) => a.t - b.t).splice(1);
            }
            history.push(
                {
                    "v": value,
                    "t": new Date().valueOf()
                });

            refreshHistoryItems(history);
            sessionStorage.setItem("history", JSON.stringify(history));
        }

        function refreshHistoryItems(history) {
            historyItems = document.getElementById("historyItems");
            historyItems.innerHTML = "";
            for(var i = history.length - 1; i >= 0; i--) {
                var historyItem = document.createElement("div");
                historyItem.setAttribute("class", "historyItem");
                historyItem.setAttribute("ondblclick", "setFromHistory(" + i + ");");
                //TODO add preview on mouse over
                //TODO add set button
                //TODO add insert button
                //TODO add remove button
                historyItem.innerText = history[i].v;
                historyItems.appendChild(historyItem);
            }
        }

        function setFromHistory(index) {
            var history = JSON.parse(sessionStorage.getItem("history"));
            getValueElement().value = history[index].v;
            flashValue();
        }

        function initHistory() {
            if(typeof(sessionStorage.getItem("history")) !== "string") {
                sessionStorage.setItem("history", JSON.stringify([]));
            } else {
                refreshHistoryItems(JSON.parse(sessionStorage.getItem("history")));
            }
        }

        function isSelectionMode() {
            return document.getElementById("cbSelection").checked;
        }

        function isCopyMode() {
            return document.getElementById("cbCopy").checked;
        }

        function flashValue() {
            var valueTextArea = getValueElement();
            var color = valueTextArea.style.backgroundColor;
            valueTextArea.style.backgroundColor = "gray";
            setTimeout(function () { valueTextArea.style.backgroundColor = color; }, 150);
        }

        function displayResult(result) {
            var valueTextArea = getValueElement();
            if (isCopyMode()) {
                flashValue()

                copyToClipboard(result);
            } else {
                if (isSelectionMode()) {
                    var currentValue = valueTextArea.value;
                    var value = currentValue.substr(0, cursorPos.start) + result + currentValue.substr(cursorPos.end, currentValue.length - cursorPos.end);

                    valueTextArea.value = value;

                    valueTextArea.selectionStart = valueTextArea.selectionEnd = cursorPos.start

                    //preventing scroll to bottom on large texts
                    valueTextArea.blur();
                    valueTextArea.focus();
                    cursorPos.end = cursorPos.start + result.length;
                    
                    valueTextArea.setSelectionRange(cursorPos.start, cursorPos.end);

                    valueTextArea.focus();

                } else {
                    valueTextArea.value = result;
                }
            }
        }

        var auxiliary = {

            uuidv4: function () {
                try {
                    return crypto.randomUUID();
                } catch (e) {
                    //fallback in case of insecure context being used or unavailable
                    console.error(e);
                    return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>
                        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
                    );
                }


            },

            arrayBufferToBase64: function (buffer) {
                var binary = '';
                var bytes = new Uint8Array(buffer);
                var len = bytes.byteLength;
                for (var i = 0; i < len; i++) {
                    binary += String.fromCharCode(bytes[i]);
                }
                return window.btoa(binary);
            },

            base64ToArrayBuffer: function (base64) {
                var binary_string =  window.atob(base64);
                var len = binary_string.length;
                var bytes = new Uint8Array(len);
                for (var i = 0; i < len; i++)        {
                    bytes[i] = binary_string.charCodeAt(i);
                }
                return bytes.buffer;
            }

        };

        //Generators
        var gens = (function () {

            //private functions


            //public functions
            return {
                generateGuid: function () {
                    return auxiliary.uuidv4();
                },

                randomString: function (params) {
                    var rndStringParams = params.loadParams();
                    var length = rndStringParams.length;

                    var validTypes = [];

                    if (rndStringParams.lower == true) {
                        validTypes.push(function (r) { return String.fromCharCode(r % 26 + 97); })
                    }

                    if (rndStringParams.upper == true) {
                        validTypes.push(function (r) { return String.fromCharCode(r % 26 + 65); })
                    }

                    if (rndStringParams.digits == true) {
                        validTypes.push(function (r) { return String.fromCharCode(r % 10 + 48); })
                    }

                    if (rndStringParams.special == true && rndStringParams.specialChars.length > 0) {
                        validTypes.push(function (r) {
                            var chars = rndStringParams.specialChars;
                            return chars[r % chars.length];
                        })
                    }

                    //[\]^_!"#$%&'()*+,-./`:;<=>?{|}~
                    // escaped: "[\\]^_!\"#$%&\'()*+,-./`:;<=>?{|}~"
                    // pattern: [\[\\\]\^_!"#\$%&'\(\)\*\+,-\.\/`:;<=>\?\{\|\}~]+

                    var result = "";

                    if (validTypes.length > 0) {
                        var types = crypto.getRandomValues(new Uint8Array(length));
                        var chars = crypto.getRandomValues(new Uint8Array(length));

                        for (var i = 0; i < length; i++) {
                            var type = types[i] % validTypes.length;
                            result += validTypes[type](chars[i]);
                        }
                    }

                    return result;
                },


                isoDateTime: function() {
                    return new Date().toISOString();
                },

                epoch: function() {
                    return new Date().valueOf().toString();
                }
                
                //Add more generators here.

            }
        })();


        //Transformers
        var trs = (function () {

            //private functions

            function escapeHtmlChar(original, xmlSafe) {
                var found = true;

                var thechar = original.charCodeAt(0);

                switch (thechar) {
                    case 60: return "&lt;"; break; //<
                    case 62: return "&gt;"; break; //>
                    case 34: return "&quot;"; break; //"

                    case 38: return "&amp;"; break; //&
                    default: found = false; break;
                }

                if (!xmlSafe) {
                    switch (thechar) {
                        case 198: return "&AElig;"; break;
                        case 193: return "&Aacute;"; break;
                        case 194: return "&Acirc;"; break;
                        case 192: return "&Agrave;"; break;
                        case 197: return "&Aring;"; break;
                        case 195: return "&Atilde;"; break;
                        case 196: return "&Auml;"; break;
                        case 199: return "&Ccedil;"; break;
                        case 208: return "&ETH;"; break;
                        case 201: return "&Eacute;"; break;
                        case 202: return "&Ecirc;"; break;
                        case 200: return "&Egrave;"; break;
                        case 203: return "&Euml;"; break;
                        case 205: return "&Iacute;"; break;
                        case 206: return "&Icirc;"; break;
                        case 204: return "&Igrave;"; break;
                        case 207: return "&Iuml;"; break;
                        case 209: return "&Ntilde;"; break;
                        case 211: return "&Oacute;"; break;
                        case 212: return "&Ocirc;"; break;
                        case 210: return "&Ograve;"; break;
                        case 216: return "&Oslash;"; break;
                        case 213: return "&Otilde;"; break;
                        case 214: return "&Ouml;"; break;
                        case 222: return "&THORN;"; break;
                        case 218: return "&Uacute;"; break;
                        case 219: return "&Ucirc;"; break;
                        case 217: return "&Ugrave;"; break;
                        case 220: return "&Uuml;"; break;
                        case 221: return "&Yacute;"; break;
                        case 225: return "&aacute;"; break;
                        case 226: return "&acirc;"; break;
                        case 230: return "&aelig;"; break;
                        case 224: return "&agrave;"; break;
                        case 229: return "&aring;"; break;
                        case 227: return "&atilde;"; break;
                        case 228: return "&auml;"; break;
                        case 231: return "&ccedil;"; break;
                        case 233: return "&eacute;"; break;
                        case 234: return "&ecirc;"; break;
                        case 232: return "&egrave;"; break;
                        case 240: return "&eth;"; break;
                        case 235: return "&euml;"; break;
                        case 237: return "&iacute;"; break;
                        case 238: return "&icirc;"; break;
                        case 236: return "&igrave;"; break;
                        case 239: return "&iuml;"; break;
                        case 241: return "&ntilde;"; break;
                        case 243: return "&oacute;"; break;
                        case 244: return "&ocirc;"; break;
                        case 242: return "&ograve;"; break;
                        case 248: return "&oslash;"; break;
                        case 245: return "&otilde;"; break;
                        case 246: return "&ouml;"; break;
                        case 223: return "&szlig;"; break;
                        case 254: return "&thorn;"; break;
                        case 250: return "&uacute;"; break;
                        case 251: return "&ucirc;"; break;
                        case 249: return "&ugrave;"; break;
                        case 252: return "&uuml;"; break;
                        case 253: return "&yacute;"; break;
                        case 255: return "&yuml;"; break;
                        case 162: return "&cent;"; break;
                        default:
                            found = false;
                            break;
                    }
                }

                if (!found) {
                    var hex = new Array('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f');
                    if (thechar > 127) {
                        var c = thechar;
                        var a4 = c % 16;
                        c = Math.floor(c / 16);
                        var a3 = c % 16;
                        c = Math.floor(c / 16);
                        var a2 = c % 16;
                        c = Math.floor(c / 16);
                        var a1 = c % 16;
                        //	alert(a1);
                        return "&#x" + hex[a1] + hex[a2] + hex[a3] + hex[a4] + ";";
                    }
                    else {
                        return original;
                    }
                }
            }

            function encodeChar(original, skipNewLine) {
                if (skipNewLine && original == '\n') return;
                var found = true;
                var thecharchar = original.charAt(0);
                var thechar = original.charCodeAt(0);
                switch (thecharchar) {
                    case '\n': return "\\n"; break; //newline
                    case '\r': return "\\r"; break; //Carriage return
                    case '\'': return "\\'"; break;
                    case '"': return "\\\""; break;
                    case '\\': return "\\\\"; break;
                    case '\t': return "\\t"; break;
                    case '\b': return "\\b"; break;
                    case '\f': return "\\f"; break;

                    default:
                        found = false;
                        break;
                }
                if (!found) {
                    var hex = new Array('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f');

                    if (thechar > 127) {
                        var c = thechar;
                        var a4 = c % 16;
                        c = Math.floor(c / 16);
                        var a3 = c % 16;
                        c = Math.floor(c / 16);
                        var a2 = c % 16;
                        c = Math.floor(c / 16);
                        var a1 = c % 16;
                        //	alert(a1);
                        return "\\u" + hex[a1] + hex[a2] + hex[a3] + hex[a4] + "";
                    }
                    else {
                        return original;
                    }
                }


            }

            function xslTransform(source, xslTransformer) {
                var xmlDoc = new DOMParser().parseFromString(source, 'application/xml');
                var xsltDoc = new DOMParser().parseFromString(xslTransformer, 'application/xml');
                var xsltProcessor = new XSLTProcessor();    
                xsltProcessor.importStylesheet(xsltDoc);
                var resultDoc = xsltProcessor.transformToDocument(xmlDoc);
                var result = new XMLSerializer().serializeToString(resultDoc);

                //check for errors
                var resultParser = new DOMParser();
                resultDoc = resultParser.parseFromString(result, "application/xml");

                var errorElem = xmlDoc.getElementsByTagName("parsererror");
                if(errorElem.length > 0) {
                    error("Error parsing value: " + errorElem[0].getElementsByTagName("div")[0].innerHTML, 5000);
                    return source;
                }
                return result;
            }

            var prettifyXml = function(sourceXml, pretty, paddingChars) {

                var resultXml = xslTransform(sourceXml, [
                    // describes how we want to modify the XML - indent everything
                    '<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">',
                    '  <xsl:strip-space elements="*"/>',
                    '  <xsl:template match="para[content-style][not(text())]">', // change to just text() to strip space in text nodes
                    '    <xsl:value-of select="normalize-space(.)"/>',
                    '  </xsl:template>',
                    '  <xsl:template match="node()|@*">',
                    '    <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>',
                    '  </xsl:template>',
                    '  <xsl:output indent="' + (pretty? 'yes': 'no') + '"/>',
                    '</xsl:stylesheet>',
                ].join('\n'));

                if(pretty == true) {
                    // Replace indentation 2 spaces with padding chars

                    if(paddingChars !== "  ") {

                        function replacer(match, p1, offset, string) {
                            return match.replaceAll("  ", paddingChars);
                        }
                        resultXml = resultXml.replace(/>\n(\s\s)+</g, replacer);
                    }
                }

                return resultXml;
            };

            function formatXml(xml, pretty, paddingChars) {

                try {
                    return prettifyXml(xml, pretty, paddingChars)
                } catch (e) {
                    console.warn(e);
                    // use fallback code bellow in case of exception
                }

                var formatted = '';
                var reg = /(>)(<)(\/*)/g;
                var paddingStr = paddingChars;
                xml = xml.replace(reg, '$1\r\n$2$3');
                var pad = 0;
                var lines = xml.split('\r\n');
                for (var index = 0; index < lines.length; index++) {
                    var node = lines[index];
                    var indent = 0;
                    if (node.match(/.+<\/\w[^>]*>$/)) {
                        indent = 0;
                    } else if (node.match(/^<\/\w/)) {
                        if (pad != 0) {
                            pad -= 1;
                        }
                    } else if (node.match(/^<\w[^>]*[^\/]>.*$/)) {
                        indent = 1;
                    } else {
                        indent = 0;
                    }

                    var padding = '';
                    for (var i = 0; i < pad; i++) {
                        padding += paddingStr;
                    }

                    formatted += padding + node + '\r\n';
                    pad += indent;
                }
                return formatted;
            }

            function encodeUrlToken(input) {
                var ret = input.replace(/\+/g, "-").replace(/\//g, "_");
                if (ret.length == 0)
                    return "";
                var noPadding = ret.replace(/=+$/, "");
                return noPadding + (ret.length - noPadding.length).toString();
            }

            function decodeUrlToken(input) {
                var ec = parseInt(input.substring(input.length - 1));
                var temp = input.replace(/\-/g, "+").replace(/\_/g, "/");
                temp = temp.substring(0, temp.length - 1);
                return temp + "===".substring(0, ec);
            }

            function indexes(value, toFind, startingAt, found) {
                if(typeof(found) == "undefined") { found = []; }
                if(typeof(startingAt) == "undefined") { startingAt = 0; }

                var idx = value.indexOf(toFind, startingAt);
                
                if(idx == -1) { return found; }

                found.push(idx);
                return indexes(value, toFind, idx + toFind.length, found);
            }

            function compressArrayBuffer(input, algorithm) {
                const stream = new Response(input).body
                    .pipeThrough(new CompressionStream(algorithm));
                return new Response(stream).arrayBuffer();
            }

            function decompressArrayBuffer(input, algorithm) {
                const stream = new Response(input).body
                    .pipeThrough(new DecompressionStream(algorithm));
                return new Response(stream).arrayBuffer();
            }

            // public functions
            return {
                urlencode: function (value) {
                    return encodeURIComponent(value);
                },

                urldecode: function (value) {
                    try {
                        return decodeURIComponent(value);
                    }
                    catch (e) {
                        console.error(e);
                        return -1;
                    }
                },

                htmlencode: function (value) {
                    return document.createElement('a').appendChild(
                        document.createTextNode(value)).parentNode.innerHTML;
                },

                htmlencode2: function (value, params) {
                    var result = "";
                    var xmlSafe = params.xmlSafe() == true;

                    for (var i = 0; i < value.length; i++) {
                        result += escapeHtmlChar(value[i], xmlSafe);
                    }

                    return result;
                },

                htmldecode: function (value) {
                    var a = document.createElement('a'); a.innerHTML = value;
                    return a.textContent;
                },

                base64encode: function (value) {
                    return window.btoa(value);
                },

                base64decode: function (value) {
                    try {
                        return window.atob(value);
                    }
                    catch (e) {
                        console.error(e);
                        return -1;
                    }
                },

                hexencode: function (value) {
                    var hex = "";
                    for (var i = 0; i < value.length; i++) {
                        hex += '' + value.charCodeAt(i).toString(16);
                    }

                    return hex;
                },

                hexdecode: function (value) {
                    var hex = value;
                    var str = "";
                    for (var i = 0; i < hex.length; i += 2) {
                        str += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
                    }

                    return str;
                },

                JavaCSharp_StringEscape: function (value) {
                    var preescape = "" + value;
                    var escaped = "";

                    var i = 0;
                    for (i = 0; i < preescape.length; i++) {
                        escaped = escaped + encodeChar(preescape.charAt(i), false);
                    }

                    return escaped;
                },

                JavaCSharp_StringUnescape: function (value) {
                    try {
                        var replacement = `##TEMP##${auxiliary.uuidv4()}##`;
                        var temp = eval(`new String(\'${value.replaceAll("'", replacement)}\')`);
                        return temp.replaceAll(replacement, "'");
                    } catch (error) {
                        console.error(error);
                        warn("Could not unescape. Make sure you have no invalid characters like line breaks.", 5000);
                        return value;
                    }
                },

                prettyPrintXml: function (value, params) {
                    var p1 = params.getPadding();
                    return formatXml(value, true, p1);
                },

                minifyXml: function (value, params) {
                    return formatXml(value, false);
                },

                prettyPrintJSON: function (value, params) {
                    var p2 = params.getPadding();
                    return JSON.stringify(JSON.parse(value), null, p2);
                },

                minifyJSON: function (value) {
                    return JSON.stringify(JSON.parse(value));
                },

                toUpperCase: function (value) {
                    return value.toUpperCase();
                },

                toLowerCase: function (value) {
                    return value.toLowerCase();
                },

                urlTokenDecode: function (value) {
                    var intermediate = decodeUrlToken(value);
                    return trs.base64decode(intermediate);
                },

                urlTokenEncode: function (value) {
                    var intermediate = base64encode(value);
                    return trs.encodeUrlToken(value);
                },

                replicate: function (value) {
                    return value + value;
                },

                sort: function(value, params) {
                    return params.isAscending()?
                        value.split("\n").sort().join("\n") :
                        value.split("\n").sort().reverse().join("\n");
                },

                JavaCSharp_Stringify: function(value) {
                    var lines = value.split("\n");
                    var result = "";
                    for(var i = 0; i < lines.length; i++) {
                        result += (i == 0? "": "+ ")
                        + "\"" + trs.JavaCSharp_StringEscape(lines[i])
                        + (i == lines.length - 1? "\"": "\\n\"" + "\n");
                    }
                    return result;
                },

                JavaCSharp_Unstringify: function(value) {
                    var lines = value.split(/\s*\n\s*\+\s*/);
                    var result = "";
                    for(var i = 0; i < lines.length; i++) {
                        if(lines[i].match(/^".*"$/) == null) {
                            warn("Could not unstringify. Make sure you have valid Java/C# strings.", 5000);
                            return value;
                        }
                        result += trs.JavaCSharp_StringUnescape(lines[i].substr(1, lines[i].length - 2));
                    }
                    return result;
                },

                xmlToJson: function(value) {
                    return xmlToJsonAux(value);
                },

                replace: function(value, params) {
                    var replaceValue = params.replaceValue();
                    var replaceWith = params.replaceWith();
                    var replaceAll = params.all();
                    var caseSensitive = params.caseSensitive();

                    if(replaceValue == "") {
                        warn("Nothing to replace");
                        return -1;
                    }

                    var result = value;

                    if(params.isRegex()) {
                        var regex = new RegExp();
                        try {
                            regex = new RegExp(replaceValue,
                            "m" + (caseSensitive == true? "": "i") + (replaceAll == true? "g": ""));
                        } catch(e) {
                            console.error(e);
                            error(e.message);
                            return -1;
                        }

                        result = value.replace(regex, replaceWith);

                        return result;
                        
                    } else {
                        if(caseSensitive == true) {
                            if(replaceAll == true) {
                                result = value.replaceAll(replaceValue, replaceWith);
                            } else {
                                result = value.replace(replaceValue, replaceWith);
                            }
                            if(result == value) {
                                info("'"+ replaceValue + "'" + " was not found.")
                                return -1;
                            }
                            return result;
                        } else {
                            if(replaceAll == true) {
                                var found = indexes(value.toLowerCase(), replaceValue.toLowerCase());
                                if(found.length == 0) {
                                    info("'"+ replaceValue + "'" + " was not found.")
                                    return -1;
                                }
                                var result = value;
                                found.reverse().forEach(foundIndex => result = result.substr(0, foundIndex) + replaceWith + result.substr(foundIndex + replaceValue.length));
                                return result;
                            } else {
                                var foundIndex = value.toLowerCase().indexOf(replaceValue.toLowerCase());
                                if(foundIndex == -1) {
                                    info("'"+ replaceValue + "'" + " was not found.")
                                    return -1;
                                }
                                
                                return value.substr(0, foundIndex) + replaceWith + value.substr(foundIndex + replaceValue.length);
                            }
                        }
                    }
                },

                compress: function(value, params) {
                    var algorithm = params.compressAlgorithm();
                    return { promise: compressArrayBuffer(value, algorithm), finalize: null };
                },

                decompress: function(value, params) {
                    var algorithm = params.compressAlgorithm();
                    var arrayBufferValue = auxiliary.base64ToArrayBuffer(value);

                    return { promise: decompressArrayBuffer(arrayBufferValue, algorithm), finalize: window.atob };
                }


                // TODO: add more transformers here

            };
        })();


        function copyToClipboard(value) {
            var toCopy = document.createElement("textarea");
            toCopy.style.width = 0;
            toCopy.style.height = 0;
            toCopy.value = value;
            document.body.appendChild(toCopy);

            /* Select the text field */
            toCopy.select();
            toCopy.setSelectionRange(0, value.length + 1); /*For mobile devices*/

            /* Copy the text inside the text field */
            document.execCommand("copy");

            document.body.removeChild(toCopy);

            info("Value " + (value.length < 100 ? value : "") + " copied to clipboard!");
        }

        function clearValue() {
            var valueTextArea = getValueElement();
            valueTextArea.value = "";
            valueTextArea.focus();
        }

        function cropToSelection() {
            var valueTextArea = getValueElement();
            valueTextArea.value = valueTextArea.value.substr(cursorPos.start, cursorPos.end - cursorPos.start);
            valueTextArea.focus();
        }

        function saveToFile() {
            var valueTextArea = getValueElement();
            var value = isSelectionMode()? valueTextArea.value.substr(cursorPos.start, cursorPos.end - cursorPos.start): valueTextArea.value;
            if(value.length == 0) {
                info("Nothing to save.");
                return;
            }
            var a = document.createElement("a");
            a.href = window.URL.createObjectURL(new Blob([value], {type: "text/plain"}));
            a.download = "file.txt";
            a.click();
        }

        var cursorPos = {
            start: -1,
            end: -1,
            line: -1,
            column: -1
        };
        
        function getCursorPos(input) {
            if ("selectionStart" in input && document.activeElement == input) {
                cursorPos.start = input.selectionStart;
                cursorPos.end = input.selectionEnd;
                cursorPos.line = input.value.substr(0, input.selectionStart).split(/\r?\n|\r/).length;
                cursorPos.column = getCol(input, input.selectionStart);
                return cursorPos;
            }
            else if (input.createTextRange) {
                var sel = document.selection.createRange();
                if (sel.parentElement() === input) {
                    var rng = input.createTextRange();
                    rng.moveToBookmark(sel.getBookmark());
                    for (var len = 0;
                        rng.compareEndPoints("EndToStart", rng) > 0;
                        rng.moveEnd("character", -1)) {
                        len++;
                    }
                    rng.setEndPoint("StartToStart", input.createTextRange());
                    for (var pos = { start: 0, end: len };
                        rng.compareEndPoints("EndToStart", rng) > 0;
                        rng.moveEnd("character", -1)) {
                        pos.start++;
                        pos.end++;
                    }

                    pos.line = input.value.substr(0, input.selectionStart).split(/\r?\n|\r/).length;
                    pos.column = getCol(input, input.selectionStart);
                    cursorPos = pos;
                    return cursorPos;
                }
            }
            cursorPos = {
                start: -1,
                end: -1,
                line: -1,
                column: -1
            };
            return cursorPos;
        }

        function formatWhitepacePadding() {
            return (document.getElementById("useTabs").checked == true) ? '\t' : '  ';
        }

        function xmlSafe() {
            return document.getElementById("xmlSafe").checked;
        }

        function sortIsAscending() {
            return !document.getElementById("sortDescending").checked;
        }

        function isReplaceRegex() {
            return document.getElementById("replaceRegex").checked;
        }

        function getReplaceValue() {
            return document.getElementById("replaceValue").value;
        }

        function getReplaceWith() {
            return document.getElementById("replaceWith").value;
        }

        function getCompressAlgorithm() {
            return document.getElementById("compressAlgorithm").value;
        }

        function getReplaceAll() {
            return document.getElementById("replaceAll").checked;
        }

        function getReplaceCaseSensitive() {
            return document.getElementById("replaceCaseSensitive").checked;
        }

        function getCol(value, start) {
            var index = start;
            var char = '\n';
            do {
                char = value.value[-1 + index--];
            } while (char != '\n' && char != '\r' && index >= 0);
            return start - index - 1;
        }

        function fetchData() {
            if(document.activeElement == getValueElement()) {
                var valueTextArea = getValueElement();
                var pos = getCursorPos(valueTextArea);

                document.getElementById("start").innerHTML = pos.start;
                document.getElementById("end").innerHTML = pos.end;
                document.getElementById("length").innerHTML = valueTextArea.value.length;

                document.getElementById("line").innerHTML = pos.line;
                document.getElementById("col").innerHTML = pos.column;
            }
        }

        function rndSpecialChanged(event) {
            if (event.target.checked == false) {
                document.getElementById('rndSpecialChars').setAttribute("disabled", "");
            } else {
                document.getElementById('rndSpecialChars').removeAttribute("disabled");
            }
        }

        var stopRndChangeEvent = false;

        function preventInvalidSpecialChars(event) {
            if (event.keyCode < 32) {
                return true;
            }
            var pattern = new RegExp(event.target.pattern);

            return pattern.test(event.key) == true;
        }

        function preventInvalidRndLength(event) {
            if(parseInt(this.value) > parseInt(this.max) || parseInt(this.value) < parseInt(this.min)) {
                this.value = this.max;
            }
        }

        function adjustRndStringSlider(slider) {
            slider.style.backgroundSize = (slider.value - slider.min) * 100 / (slider.max - slider.min) + '% 100%';
        }

        function getRandomStringParams() {
            return {
                length: document.getElementById("rndStringLength").value,
                lower: document.getElementById("rndLower").checked,
                upper: document.getElementById("rndUpper").checked,
                digits: document.getElementById("rndDigits").checked,
                special: document.getElementById("rndSpecial").checked,
                specialChars: document.getElementById("rndSpecial").checked == true ? document.getElementById("rndSpecialChars").value : ""
            };
        }

        var messageId = null;
        function info(text, delay) {
            document.getElementById("messageType").innerHTML = "&#8505;&nbsp;Info";
            document.getElementById("messageText").innerText = text;

            document.getElementById("message").style.background = "aliceblue";
            document.getElementById("message").style.color = "#7070A0";

            document.getElementById("message").style.display = "flex";

            var id = auxiliary.uuidv4();
            messageId = id;
            window.setTimeout(function () { if (id != messageId) { return; } document.getElementById("message").style.display = "none"; }, typeof delay == "number" ? delay : 2000);
        }

        function warn(text, delay) {
            document.getElementById("messageType").innerHTML = "&#9888;&nbsp;Warning";
            document.getElementById("messageText").innerText = text;

            document.getElementById("message").style.background = "blanchedalmond";
            document.getElementById("message").style.color = "#806640";

            document.getElementById("message").style.display = "flex";

            var id = auxiliary.uuidv4();
            messageId = id;
            window.setTimeout(function () { if (id != messageId) { return; } document.getElementById("message").style.display = "none"; }, typeof delay == "number" ? delay : 2000);
        }

        function error(text, delay) {
            document.getElementById("messageType").innerHTML = "&#9888;&nbsp;Error";
            document.getElementById("messageText").innerText = text;

            document.getElementById("message").style.background = "coral";
            document.getElementById("message").style.color = "#905050";

            document.getElementById("message").style.display = "flex";

            var id = auxiliary.uuidv4();
            messageId = id;
            window.setTimeout(function () { if (id != messageId) { return; } document.getElementById("message").style.display = "none"; }, typeof delay == "number" ? delay : 2000);
        }

    </script>
</head>

<body>
    <textarea id="value" value="" placeholder="Text goes here..." autofocus></textarea>
    <div style="float: right;position: relative;font-size: small;">Line: <span id="line"></span><span
            style="margin-left: 10px;">Column: </span><span id="col"></span></div>
    <div style="float: right;clear: right;position: relative;font-size: small;">Start: <span id="start"></span><span
            style="margin-left: 10px;">End: </span><span id="end"></span><span style="margin-left: 10px;">Length:
        </span><span id="length"></span></div>
    <div>
        <!--TODO review/improve url and html encoders-->
        <div class="buttonGroup">
            <input type="button" class="button button-xsmall" value="URL Encode"
                onclick="transform(trs.urlencode);" /><br />
            <input type="button" class="button button-xsmall" value="URL Decode" onclick="transform(trs.urldecode);" />
            <hr/>
            <input type="button" class="button button-xsmall" value="URL Token Encode"
                onclick="transform(trs.urlTokenEncode);" /><br />
            <input type="button" class="button button-xsmall" value="URL Token Decode"
                onclick="transform(trs.urlTokenDecode);" />
        </div>
        <div class="buttonGroup">
            <input type="button" class="button button-xsmall" value="HTML Encode"
                onclick="transform(trs.htmlencode2, {'xmlSafe': xmlSafe});" />
            <br />
            <label class="off-on">
                <input id="xmlSafe" type="checkbox" checked />
                <span class="off-on-slider round"></span>
            </label><label for="xmlSafe">XML safe?</label>
            <br />
            <input type="button" class="button button-xsmall" value="HTML Decode"
                onclick="transform(trs.htmldecode);" />
        </div>

        <div class="buttonGroup">
            <input type="button" class="button button-xsmall" value="Base64 Encode"
                onclick="transform(trs.base64encode);" /><br />
            <input type="button" class="button button-xsmall" value="Base64 Decode"
                onclick="transform(trs.base64decode);" />
            <hr/>
            <input type="button" class="button button-xsmall" value="HEX Encode"
                onclick="transform(trs.hexencode);" /><br />
            <input type="button" class="button button-xsmall" value="HEX Decode"
                onclick="transform(trs.hexdecode);" />
        </div>

        <div class="buttonGroup">
            <input type="button" class="button button-xsmall" value="Java/C# String Escape"
                onclick="transform(trs.JavaCSharp_StringEscape);" /><br />
            <input type="button" class="button button-xsmall" value="Java/C# String Unescape"
                onclick="transform(trs.JavaCSharp_StringUnescape);" /><br />
            <input type="button" class="button button-xsmall" value="Java/C# Stringify"
                onclick="transform(trs.JavaCSharp_Stringify);" /><br />
            <input type="button" class="button button-xsmall" value="Java/C# Unstringify"
                onclick="transform(trs.JavaCSharp_Unstringify);" />
        </div>

        <div class="checkAlign">
            <div class="buttonGroup">
                <input type="button" class="button button-xsmall" value="Pretty Print XML"
                    onclick="transform(trs.prettyPrintXml, { 'getPadding': formatWhitepacePadding });"><br />
                <input type="button" class="button button-xsmall" value="Minify XML"
                    onclick="transform(trs.minifyXml);">
            </div>
            <div class="buttonGroup">
                <input type="button" class="button button-xsmall" value="Pretty Print JSON"
                    onclick="transform(trs.prettyPrintJSON, { 'getPadding': formatWhitepacePadding });"><br />
                <input type="button" class="button button-xsmall" value="Minify JSON"
                    onclick="transform(trs.minifyJSON);">
            </div>
            <br />
            <hr />

            <label class="switch">
                <input type="checkbox" id="useTabs">
                <span class="slider round slider-padding"></span>
            </label>
        </div>
        
        <div class="buttonGroup">
            <input type="button" class="button button-xsmall" value="Compress"
                onclick="transform(trs.compress, {'compressAlgorithm': getCompressAlgorithm });" /><br />
            <input type="button" class="button button-xsmall" value="Decompress"
                onclick="transform(trs.decompress, {'compressAlgorithm': getCompressAlgorithm });" /><br />
            <select id="compressAlgorithm" class="button button-xsmall" style="text-align: left;">
                <option selected value="deflate">
                    Deflate
                </option>
                <option value="deflate-raw">
                    Deflate Raw
                </option>
                <option value="gzip">
                    GZip
                </option>
            </select>
        </div>

        <div class="buttonGroup">
            <input type="button" class="button button-xsmall" value="To UPPERCASE"
                onclick="transform(trs.toUpperCase);" /><br />
            <input type="button" class="button button-xsmall" value="To lowercase"
                onclick="transform(trs.toLowerCase);" />
            <!--TODO: to consider: camelCase, kebab-case, snake_case-->
        </div>

        <div class="buttonGroup">
            <input type="button" class="button button-xsmall" value="Replicate"
                onclick="transform(trs.replicate);" />
        </div>
        <div class="buttonGroup">
            <input type="button" class="button button-xsmall" value="Sort lines"
                onclick="transform(trs.sort, {'isAscending': sortIsAscending });" />
            <br/>
            <label class="switch">
                <input type="checkbox" id="sortDescending">
                <span class="slider round slider-sort"></span>
            </label>
        </div>
    </div>
    <hr />
    <div>
        <div class="buttonGroup">
            <input type="button" class="button button-xsmall" value="Clear"
                onclick="clearValue();" /><br/>
            <input type="button" class="button button-xsmall" value="Crop"
                onclick="cropToSelection();" /><br/>
            <input type="button" class="button button-xsmall" value="Save as..."
                onclick="saveToFile();" />
        </div>
        <div class="buttonGroup">
            <input type="button" class="button button-xsmall" value="New GUID"
                onclick="generate(gens.generateGuid);" /><br/>
            <input type="button" class="button button-xsmall" value="ISO DateTime"
                onclick="generate(gens.isoDateTime);" /><br/>
            <input type="button" class="button button-xsmall" value="Epoch"
                onclick="generate(gens.epoch);" />
        </div>

        <div class="buttonGroup settingsGroup">
            <label>Random string</label><br />
            <input id="rndStringLength" type="range" min="1" max="256" value="10"
                style="width: 350px;"
                oninput="adjustRndStringSlider(this); stopRndChangeEvent = true; rndStringLengthNumberInput.value = value; generate(gens.randomString, { loadParams: getRandomStringParams });"
                onclick="adjustRndStringSlider(this); if(stopRndChangeEvent == true) { stopRndChangeEvent = false; } else { generate(gens.randomString, { loadParams: getRandomStringParams }); }" />
            <input id="rndStringLengthNumberInput" type="number" min="1" max="256" value="10" style="width: 50px;" onchange="rndStringLength.value = value; rndStringLength.click()"/><br />
            <label class="off-on">
                <input id="rndLower" type="checkbox" checked
                onchange="generate(gens.randomString, { loadParams: getRandomStringParams });"/>
                <span class="off-on-slider round"></span>
            </label><label for="rndLower">Alpha lowercase</label><br />

            <label class="off-on">
                <input id="rndUpper" type="checkbox" checked
                onchange="generate(gens.randomString, { loadParams: getRandomStringParams });"/>
                <span class="off-on-slider round"></span>
            </label><label for="rndUpper">Alpha UPPERCASE</label><br />
            
            <label class="off-on">
                <input id="rndDigits" type="checkbox" checked
                onchange="generate(gens.randomString, { loadParams: getRandomStringParams });"/>
                <span class="off-on-slider round"></span>
            </label><label for="rndDigits">Digits</label><br />

            <label class="off-on">
                <input id="rndSpecial" type="checkbox"
                onchange="rndSpecialChanged(event); generate(gens.randomString, { loadParams: getRandomStringParams });"/>
                <span class="off-on-slider round"></span>
            </label><label for="rndSpecial">Special</label>&nbsp;
            <input id="rndSpecialChars" type="text" value="[\]^_!&quot;#$%&amp;'()*+,-./`:;&lt;=&gt;?{|}~"
                pattern="[\[\\\]\^_!&quot;#\$%&amp;'\(\)\*\+,-\.\/`:;&lt;=&gt;\?\{\|\}~]+" size="31"
                placeholder="Special chars" disabled
                onchange="generate(gens.randomString, { loadParams: getRandomStringParams });" />
            <!--onkeyup for rndSpecialChars defined on page load-->
        </div>

        <div class="buttonGroup">
            <input type="text" id="replaceValue" placeholder="To replace..." style="margin: 4px 2px;" /><br/>
            <input type="text" id="replaceWith" placeholder="Replace with..." style="margin: 4px 2px;" /><br/>
            <input type="button" class="button button-xsmall" value="Replace"
                onclick="transform(trs.replace, {'isRegex': isReplaceRegex, 'replaceValue': getReplaceValue, 'replaceWith': getReplaceWith, 'all': getReplaceAll, 'caseSensitive': getReplaceCaseSensitive });" /><br/>
            <label class="off-on">
                <input id="replaceAll" type="checkbox" checked />
                <span class="off-on-slider round"></span>
            </label><label for="replaceAll">Replace all</label><br/>
            <label class="off-on">
                <input id="replaceRegex" type="checkbox" />
                <span class="off-on-slider round"></span>
            </label><label for="replaceRegex">Use RegEx</label><br/>
            <label class="off-on">
                <input id="replaceCaseSensitive" type="checkbox" checked />
                <span class="off-on-slider round"></span>
            </label><label for="replaceCaseSensitive">Case sensitive</label>
        </div>
    </div>
    <hr />

    <p>Mode</p>
    <label class="switch">
        <input type="checkbox" id="cbCopy">
        <span class="slider round slider-copy"></span>
    </label>
    <label class="switch">
        <input type="checkbox" id="cbSelection">
        <span class="slider round slider-selection"></span>
    </label>

    <div id="message"
        style="position: fixed; left: 10px;bottom: 10px;right: 10px;z-index: 1000;background: blanchedalmond;color: #909090;display: none;align-items: center;">
        <strong id="messageType" style="padding: 10px;float: left;">Info</strong>
        <span id="messageText" style="padding: 3px;">.</span>
    </div>

    <div class="sidebar">
        <div onclick="this.parentElement.classList.toggle('sidebarExpanded');" style="writing-mode: vertical-rl;user-select: none;border-right: 20px solid #ccc;border-bottom: 15px solid transparent;border-top: 15px solid transparent;
        width: 0px;height: 62px;" onclick=""><span style="position: absolute;right: 0px;letter-spacing: 2px;color: black;">History</span></div>

        <div id="historyItems" class="sidebarBody">
        </div>
        <!-- ...Preview... TODO [Set] [Insert] [Remove] -->
    </div>
    

    <!--TODO add json tree viewer-->
    
</body>

</html>